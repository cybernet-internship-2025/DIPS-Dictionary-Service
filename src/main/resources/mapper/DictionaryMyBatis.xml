<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="az.cybernet.internship.dictionary.repository.DictionaryRepository">

    <!-- ResultMap -->
    <resultMap id="DictionaryMap" type="az.cybernet.internship.dictionary.model.DictionaryEntry">
        <id property="id" column="id"/>
        <result property="category" column="category"/>
        <result property="value" column="value"/>
        <result property="description" column="description"/>
        <result property="isActive" column="is_active"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <!-- GET /api/v1/dictionaries -->
    <select id="findAll" parameterType="Integer" resultMap="DictionaryMap">
        SELECT * FROM dictionary
        WHERE (#{id} IS NULL OR id = #{id})
          AND (#{value} IS NULL OR LOWER(value) LIKE CONCAT('%', LOWER(#{value}), '%'))
          AND (#{isActive} IS NULL OR is_active = #{isActive})
    </select>

    <!-- GET /api/v1/dictionaries/{id} -->
    <select id="findById" parameterType="java.lang.Long" resultMap="DictionaryMap">
        SELECT * FROM dictionary WHERE id = #{id}
    </select>

    <!-- PUT /api/v1/dictionaries (CREATE NEW) -->
    <insert id="insert" parameterType="az.cybernet.internship.dictionary.model.DictionaryEntry" useGeneratedKeys="true">
        INSERT INTO dictionary (category, value, description, is_active, created_at, updated_at)
        VALUES (#{category}, #{value}, #{description}, true, NOW(), null)
    </insert>

    <!-- PUT /api/v1/dictionaries (UPDATE EXISTING) -->
    <update id="update" parameterType="az.cybernet.internship.dictionary.model.DictionaryEntry">
        UPDATE dictionary
        SET value = #{value},
            description = #{description},
            updated_at = NOW()
        WHERE id = #{id}
    </update>

    <!-- DELETE /api/v1/dictionaries/{id} (Soft Delete) -->
    <update id="softDelete" parameterType="java.lang.Long">
        UPDATE dictionary
        SET is_active = false,
            updated_at = NOW()
        WHERE id = #{id}
    </update>

    <!-- POST /api/v1/dictionaries/{id}/restore -->
    <update id="restore" parameterType="java.lang.Long">
        UPDATE dictionary
        SET is_active = true,
            updated_at = null
        WHERE id = #{id}
    </update>

</mapper>
