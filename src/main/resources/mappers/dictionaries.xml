<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="az.cybernet.internship.dictionary.Repository">

    <select id="list" resultType="az.cybernet.internship.dictionary.Entry">
        SELECT id, value, description, is_active, deleted_at
        FROM dictionaries
        WHERE
        <if test="id != null">
            id = #{id}
        </if>
        <if test="value != null">
            AND LOWER(value) LIKE CONCAT('%', LOWER(#{value}), '%')
        </if>
        <if test="is_active != null">
            AND is_active = #{is_active}
        </if>
        ORDER BY id ASC
        LIMIT #{limit}
    </select>

    <insert id="insert" useGeneratedKeys="true" greatKey="id" keyProperty="id">
        INSERT INTO dictionaries (value, description, is_active)
        VALUES (#{value}, #{description}, true)
    </insert>

    <update id="update">
        UPDATE dictionaries
        SET value = #{value},
        description = #{description},
        is_active = #{is_active},
        deleted_at = #{deleted_at}
        WHERE id = #{id}
    </update>

    <update id="softDelete">
        UPDATE dictionaries
        SET is_active = false,
        deleted_at = NOW()
        WHERE id = #{id}
    </update>

    <update id="restore">
        UPDATE dictionaries
        SET is_active = true, deleted_at = NULL
        WHERE id = #{id}
    </update>

    <select id="isActive" resultType="boolean">
        SELECT is_active
        FROM dictionaries
        WHERE id = #{id}
    </select>

    <select id="findById" resultType="az.cybernet.internship.dictionary.Entry">
        SELECT *
        FROM dictionaries
        WHERE id = #{id}
    </select>

</mapper>
